try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.exchange.clients.owa2.client.core.smime.js'] = (new Date()).getTime();
Type.registerNamespace("_smim");_smim.$1ZF=function(n){this.$3jm=n};_smim.$1ZF.prototype={$3jm:null,$6o:function(n,t){_a.$4.$z(n,"functionName");_a.$4.$z(t,"message");_js.Trace.logInfo(_a.$0.$53,"{0}.{1}: {2}",this.$3jm,n,t)},$2zF:function(n,t){_a.$4.$z(n,"functionName");_a.$4.$z(t,"message");_js.Trace.logWarning(_a.$0.$53,"{0}.{1}: {2}",this.$3jm,n,t)},$4KH:function(n,t){_a.$4.$z(n,"functionName");_a.$4.$z(t,"message");_js.Trace.logError(_a.$0.$53,"{0}.{1}: {2}",this.$3jm,n,t)}};_smim.$1Ql=function(){this.$$d_$7je=Function.createDelegate(this,this.$7je);this.$$d_$7jf=Function.createDelegate(this,this.$7jf);_smim.$1Ql.initializeBase(this,["SmimeItemPartViewModelCommand"])};_smim.$1Ql.prototype={$5sV:null,$4X9:null,$5YS:null,$1d:null,$BR:0,$b:null,$3e:function(n,t,i,r,u){_a.$4.$z(n,"completeViewModelInitializationCallback");_a.$4.$z(t,"createAttachmentViewModelCallback");_a.$4.$z(i,"showPopoutCommandCallback");_a.$4.$z(r,"infoBarViewModel");this.$5sV=n;this.$4X9=t;this.$5YS=i;this.$1d=r;this.$BR=u},$7jc:function(n){this.$6o("DecodeAndCompleteViewModelInitialization","Executing");this.$b=n;if(n.get_$1UI())if(_a.$c.get_$18l()&&!n.get_$t9()){this.$6o("DecodeAndCompleteViewModelInitialization","Submitting DecodeSmimeMessageAction");var t=new _h.$sT(200,n);t.add_$2s(this.$$d_$7jf);t.add_$2b(this.$$d_$7je);OwaApplication.$2B.$1U(t)}else{this.$6o("DecodeAndCompleteViewModelInitialization","Calling createAttachmentViewModelCallback");this.$4X9();this.$4W9()}else this.$4W9()},$Eec:function(){this.$6o("ShowInfobarMessages","Executing");this.$b.get_$1UI()?_a.$c.get_$22x()?_a.$c.get_$18l()?_a.$c.get_$2mc()?this.$1d.$Qg(706,null,_u.Strings.l_ClickHere_Text,this.$5YS):this.$1d.$Qg(749,null,_u.Strings.l_ClickHere_Text,_a.$c.$1Ja):this.$1d.$Qg(732,[_u.Strings.l_Smime_InstallPrefix_Text],_u.Strings.l_ClickHere_Text,_a.$c.$1Ja):this.$1d.$4r(733):_a.$c.get_$22x()||this.$b.get_$3yz()?this.$BR==="Mouse"?this.$1d.$Qg(703,null,_u.Strings.l_ClickHere_Text,this.$5YS):this.$1d.$4r(704):this.$1d.$4r(726)},$7jf:function(n){this.$6o("DecodeSmimeMessageSucceededCallback","Executing");this.$6o("DecodeSmimeMessageSucceededCallback","Calling createAttachmentViewModelCallback");this.$4X9();this.$4W9()},$7je:function(n){this.$6o("DecodeSmimeMessageFailedCallback","Executing");var t=_a.$2f.$1Ha(n.$2H,11);this.$1d.$2D5(t);this.$4W9()},$4W9:function(){this.$6o("CompleteViewModelInitialization","Executing");this.$5sV();this.$Eec()}};_smim.$1a8=function(n,t,i){_smim.$1a8.initializeBase(this,[i]);_a.$4.$z(n,"composeContext");_a.$4.$z(t,"eventAggregator");this.$Bj=n;this.$N=t};_smim.$1a8.prototype={$Bj:null,$N:null,$8WT:function(){var t=!0;var n=this.$7bO();if(n&&!_a.$2f.$3zQ(n)){this.$6o("IsReadyForSmimeOperation","Error found; returning false to prevent send operation");_a.$2f.$1Ha(n,2);this.$7Sk(n);t=!1}return t},$AV:function(){},$7Sk:function(n){throw Error.notImplemented("AddInfobarMessageForSmimeError");},$7bO:function(){return _a.$c.$4AK(!0,!0,this.$Bj.get_$6X()===1||this.$Bj.get_$6X()===2||this.$Bj.get_$6X()===3,this.$Bj.get_$6X()===3,!!this.$Bj.get_$IV()&&(this.$Bj.get_$IV().get_$1UI()||this.$Bj.get_$IV().get_$3yz()))}};_smim.$1Qf=function(n,t){this.$$d_$DRr=Function.createDelegate(this,this.$DRr);_smim.$1Qf.initializeBase(this,[n,t,"SmimeAttachmentCommand"])};_smim.$1Qf.prototype={$4n3:null,$3e:function(n){_a.$4.$z(n,"getAttachmentWellViewModel");this.$4n3=n;this.$N.$1k(_y.$mw,this.$$d_$DRr)},$AV:function(){this.$N.$4A(_y.$mw,this.$$d_$DRr);_smim.$1a8.prototype.$AV.call(this)},$1GD:function(n){var t=this.$4n3();if(!t){this.$6o("OpenFilePicker","AttachmentWellViewModel is null. Exiting.");return}if(_a.UserAgent.getInstance().$1Bp){this.$6o("OpenFilePicker",String.format("Opening browser's file picker. For inline attachment: {0}.",n));t.$1GD(n,null,null)}else{this.$6o("OpenFilePicker",String.format("Opening S/MIME's file picker. For inline attachment: {0}.",n));t.$5GS(n)}},$DRr:function(n){this.$6o("OnAttachmentComponentUpgradeEvent","getting AttachmentWellViewModel.");var t=this.$4n3();if(!t){this.$6o("OnAttachmentComponentUpgradeEvent","AttachmentWellViewModel is null. Exiting.");return}t.set_$s0(this.$Bj.get_$s0());if(!t.get_$1m()||!t.get_$1m().get_$A()){this.$6o("OnAttachmentComponentUpgradeEvent","AttachmentWellViewModel.Attachments.Count == 0. Exiting");return}if(!this.$Bj.get_$s0()){this.$6o("OnAttachmentComponentUpgradeEvent","!composeContext.IsSmimeMode. Exiting");return}var f=this;var r=function(){f.$6o("OnAttachmentComponentUpgradeEvent","MoveAttachmentsFromServerToClient will be started when MailComposeAttachmentComponent is upgraded.");var n=t;_js.$D.get_$Q().$2V(_a.$0.$dS,"MailComposeAttachmentComponent.Upgrade",n.$$d_$2qx||(n.$$d_$2qx=Function.createDelegate(n,n.$2qx)),800)};if(this.$Bj.get_$6Q6())r();else{var i=null;var u=this;i=function(n,t){if(u.$Bj.get_$6Q6()){u.$Bj.rpcl("IsEditorReady",i);r()}};this.$Bj.apcl("IsEditorReady",i)}}};_smim.$1Qi=function(){};_smim.$1Qi.prototype={$Bj:null,$N:null,$3e:function(n,t){_a.$4.$z(n,"composeContext");_a.$4.$z(t,"eventAggregator");this.$Bj=n;this.$N=t},$ALB:function(){return new _smim.$1Qf(this.$Bj,this.$N)},$7h1:function(){return new _smim.$1Qj(this.$Bj,this.$N)},$AOb:function(){return new _smim.$1Qm(this.$Bj,this.$N)},$AQp:function(){return new _smim.$1Qp(this.$Bj,this.$N)},$AR0:function(){return new _smim.$1Qq(this.$Bj,this.$N)}};_smim.$1Qj=function(n,t){_smim.$1Qj.initializeBase(this,[n,t,"SmimeInitializerCommand"])};_smim.$1Qj.prototype={$4sf:null,$1iz:null,$618:null,$n:null,$3e:function(n,t,i,r){_a.$4.$z(n,"initializeForDraftMessageCallback");_a.$4.$z(t,"addInfobarMessageForSmimeErrorCallback");_a.$4.$z(i,"endAllTracingWithErrorCallback");_a.$4.$z(r,"actionSubmitter");this.$4sf=n;this.$1iz=t;this.$618=i;this.$n=r},$6N9:function(n,t){this.$6o("InitializeForDraftMessage","Initializing for smime draft.");var r=this;var e=function(i){r.$2zF("InitializeForDraftMessage","DecodeSmimeMessageAction failure callback executing with exception "+i.message);if(_a.$2f.$1UJ(i)){r.$1iz(i);r.$618(i.message,t.$FJ(),null)}r.$Bj.$9wP(n.get_$2y7());r.$4sf(n,t)};var i=_a.$c.$4AK(!0,!0,!1,!1,!1);if(i){this.$2zF("InitializeForDraftMessage","Smime.Prepare returned error "+i.message);_a.$2f.$3zQ(i)?i=null:e(i)}var u=new _h.$sT(200,n);var f=this,o=this;this.$n.$tE(u,function(){f.$6o("InitializeForDraftMessage","DecodeSmimeMessageAction success callback executing");n.set_$Em(null);n.set_$5Q(null);n.set_$8UE(!0);f.$Bj.$9wP(n.get_$2y7());f.$4sf(n,t)},function(){_a.$2f.$1Ha(u.$2H,4);e(u.$2H)},null)}};_smim.$1Qm=function(n,t){this.$$d_$Dcl=Function.createDelegate(this,this.$Dcl);_smim.$1Qm.initializeBase(this,[n,t,"SmimeMailComposeViewModelCommand"])};_smim.$1Qm.prototype={$1d:null,$3e:function(n){_a.$4.$z(n,"infoBarViewModel");this.$1d=n;this.$N.$1k(_y.$n0,this.$$d_$Dcl)},$AV:function(){this.$N.$4A(_y.$n0,this.$$d_$Dcl);_smim.$1a8.prototype.$AV.call(this)},$Dcl:function(n){this.$6o("OnMailComposeViewModelInitializeEvent","Initializing for MailComposeViewModel...");if(this.$Bj.get_$4IE()){this.$6o("OnMailComposeViewModelInitializeEvent","Adding infobar message for error "+this.$Bj.get_$4IE());this.$1d.$2D5(new _a.$2f(this.$Bj.get_$4IE()))}this.$Bj.get_$s0()&&this.$7FS()},$7FS:function(){this.$6o("ShowSmimeControlStatusMessageIfNeeded","Prepare for Smime operations...");var n=this.$7bO();if(n){this.$6o("ShowSmimeControlStatusMessageIfNeeded","Adding infobar message for exception "+n.message);this.$1d.$2D5(n)}}};_smim.$1Qp=function(n,t){_smim.$1Qp.initializeBase(this,[n,t,"SmimeSaveCommand"])};_smim.$1Qp.prototype={$7HK:null,$71S:null,$333:null,$1iz:null,$3e:function(n,t,i,r){_a.$4.$z(n,"submitSaveAction");_a.$4.$z(t,"saveFailedCallback");_a.$4.$z(i,"buildSmimeContentCallback");_a.$4.$z(r,"addInfobarMessageForSmimeErrorCallback");this.$7HK=n;this.$71S=t;this.$333=i;this.$1iz=r},$7HL:function(n){this.$6o("SubmitSaveAction","Saving an S/MIME message...");this.$333(n,3,this.$7HK,this.$71S)},$7Sk:function(n){this.$1iz(n)}};_smim.$1Qq=function(n,t){this.$$d_$E9Y=Function.createDelegate(this,this.$E9Y);this.$$d_$E9v=Function.createDelegate(this,this.$E9v);_smim.$1Qq.initializeBase(this,[n,t,"SmimeSendCommand"])};_smim.$1Qq.prototype={$2vc:0,$5pY:null,$73t:null,$4UL:null,$5Vw:null,$5Vv:null,$6IE:null,$6ID:null,$n:null,$6Ie:null,$6Id:null,$6Ic:null,$6FP:null,$333:null,$4PO:null,$1iz:null,$3bS:null,$3e:function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){_a.$4.$z(n,"callerId");_a.$4.$z(t,"sendMessageCallback");_a.$4.$z(i,"cancelSendCallback");_a.$4.$z(r,"setSendSuccessProcessorCallback");_a.$4.$z(u,"setSendFailureProcessorCallback");_a.$4.$z(f,"getSendSuccessProcessorCallback");_a.$4.$z(e,"getSendFailureProcessorCallback");_a.$4.$z(o,"actionSubmitter");_a.$4.$z(s,"recipientWellViewModelFactory");_a.$4.$z(h,"getTotalToRecipientCountCallback");_a.$4.$z(c,"getTotalCcRecipientCountCallback");_a.$4.$z(l,"getTotalBccRecipientCountCallback");_a.$4.$z(a,"getAllEmailAddressesAsEmailAddressWrapperCallback");_a.$4.$z(v,"buildSmimeContentCallback");_a.$4.$z(y,"addInfobarMessageInContextCallback");_a.$4.$z(p,"addInfobarMessageForSmimeErrorCallback");this.$5pY=n;this.$73t=t;this.$4UL=i;this.$5Vw=r;this.$5Vv=u;this.$6IE=f;this.$6ID=e;this.$n=o;this.$6Ie=h;this.$6Id=c;this.$6Ic=l;this.$6FP=a;this.$333=v;this.$4PO=y;this.$1iz=p;this.$3bS=new _y.$18b(s)},get_$7G1:function(){return this.$3bS},$AAe:function(){this.$6o("SendMessage","Starting send");this.$Bj.set_$1yb(-1);this.$Bj.set_$1xI("");this.$2vc=0;if(this.$Bj.get_$PT()){switch(_g.$O.get_$Q().get_$VV().BccEncryptedEmailForking){case 0:case 1:if(this.$6Ie()>0||this.$6Id()>0)this.$Bj.set_$2Ag(1);else if(this.$6Ic()>0)if(_g.$O.get_$Q().get_$VV().BccEncryptedEmailForking)this.$Bj.set_$2Ag(3);else{this.$Bj.set_$2Ag(2);this.$Bj.set_$1yb(0)}break;case 2:this.$Bj.set_$2Ag(0);break;default:this.$4KH("BuildMessageAndSend","Setting IncludeAll for unknown AdminSetting BccEncryptedEmailForking = "+_g.$O.get_$Q().get_$VV().BccEncryptedEmailForking);this.$Bj.set_$2Ag(0);break}this.$6o("BuildMessageAndSend",String.format("SmimeBccMode {0} BccEncryptedEmailForking {1} ",this.$Bj.get_$2Ag(),_g.$O.get_$Q().get_$VV().BccEncryptedEmailForking))}else{this.$4KH("BuildMessageAndSend","Setting IncludeAll for SmimeEncryptMessage == false");this.$Bj.set_$2Ag(0)}this.$5Vw(this.$$d_$E9v);this.$5Vv(this.$$d_$E9Y);if(this.$Bj.get_$PT()){this.$6o("BuildMessageAndSend","Encrypt message true: Calling RetrieveCertsBuildSmimeAndSend");this.$E5P()}else{this.$6o("BuildMessageAndSend","Encrypt message false: Calling BuildSmimeContentAndSend");this.$5oM()}},$7Sk:function(n){this.$1iz(n)},$E9v:function(n){if(this.$9kJ(!1)){this.$6o("SendSuccessProcessor","Executing SendNextBccFork");this.$9SI()}else{this.$6o("SendSuccessProcessor","Executing SetDefaultSendProcessors and SendSuccessProcessor");this.$9ge();this.$6IE()(n)}},$E9Y:function(n){this.$Euy();if(this.$9kJ(!1)){this.$6o("SendFailureProcessor","Executing SendNextBccFork");this.$9SI()}else{this.$6o("SendFailureProcessor","Executing SetDefaultSendProcessors and SendFailureProcessor");this.$9ge();this.$6ID()(n)}},$Euy:function(){if(this.$Bj.get_$1yb()>-1){var u=this.$Bj.get_$1xI().length>0;var r=this.$Bj.get_$AN().get_$E(this.$Bj.get_$1yb());this.$7SP(r,u)}else for(var n=0;n<this.$Bj.get_$AN().get_$A();n++){var t=n>0;var i=this.$Bj.get_$AN().get_$E(n);this.$7SP(i,t)}},$7SP:function(n,t){if(t){var u;(u=this.$Bj).set_$1xI(u.get_$1xI()+"; ")}var r=n.Name||n.OriginalDisplayName||n.EmailAddress;this.$6o("AddFailedRecipient","Adding failedRecipient "+r);var i;(i=this.$Bj).set_$1xI(i.get_$1xI()+r)},$9kJ:function(n){if(_g.$O.get_$Q().get_$VV().BccEncryptedEmailForking&&_g.$O.get_$Q().get_$VV().BccEncryptedEmailForking!==1){this.$6o("ShouldSendNextBccFork","Returning false - bcc forking is not enabled");return!1}if(n&&!this.$2vc){this.$6o("ShouldSendNextBccFork","Returning false - the first message failed to send");return!1}if(this.$Bj.get_$PT()&&_g.$O.get_$Q().get_$VV().BccEncryptedEmailForking!==2)if(_g.$O.get_$Q().get_$VV().BccEncryptedEmailForking===1){if(this.$2vc<1&&this.$Bj.get_$AN().get_$A()>0){this.$6o("ShouldSendNextBccFork","Returning true - fork for all bcc recipients");return!0}}else if(this.$Bj.get_$1yb()<this.$Bj.get_$AN().get_$A()-1&&this.$Bj.get_$AN().get_$A()>0){this.$6o("ShouldSendNextBccFork","Returning true - fork for one message for each bcc recipients");return!0}this.$6o("ShouldSendNextBccFork","Returning false - no conditions met");return!1},$9ge:function(){this.$5Vw(null);this.$5Vv(null)},$9SI:function(){this.$Bj.set_$Fd(null);this.$Bj.set_$j0(null);if(_g.$O.get_$Q().get_$VV().BccEncryptedEmailForking===1)if(this.$2vc<1&&this.$Bj.get_$AN().get_$A()>0){this.$Bj.set_$2Ag(3);this.$6o("SendNextBccFork","IncludeAllBccInSingleMessage")}else throw Error.invalidOperation(String.format("SmimeSendCommand.SendNextBccFork failed: sentMsgCount {0} BccRecipients.Count {1}",this.$2vc,this.$Bj.get_$AN().get_$A()));else if(this.$Bj.get_$1yb()<this.$Bj.get_$AN().get_$A()-1&&this.$Bj.get_$AN().get_$A()>0){this.$Bj.set_$2Ag(2);var n;(n=this.$Bj).set_$1yb(n.get_$1yb()+1);this.$6o("SendNextBccFork",String.format("IncludeSingleBccInEachMessage, CurrentBccRecipient {0}",this.$Bj.get_$1yb()))}else throw Error.invalidOperation("SmimeSendCommand.SendNextBccFork failed");this.$6o("SendNextBccFork","Executing BuildSmimeContentAndSend");this.$5oM();this.$2vc++},$E5P:function(){this.$6o("RetrieveCertsBuildSmimeAndSend","Retrieving certs");var t=this,n=this;this.$9PI(function(){t.$6o("RetrieveCertsBuildSmimeAndSend","Retrieve certs success callback");t.$5oM()},function(){n.$6o("RetrieveCertsBuildSmimeAndSend","Retrieve certs failure callback");n.$4UL()})},$9PI:function(n,t){var f=this.$6FP();this.$6o("RetrieveCertsForSmimeEncryption","Retrieving certs of recipients: "+this.$7nE(f.get_$1y()));var i=new _h.$1GM(200,f.get_$1y());var r=this,u=this,e=this;this.$n.$tE(i,function(){r.$Bj.set_$5ZR(i.get_$Ezz());var e=r.$Bj.get_$9mj();if(e&&e.length)if(i.get_$3HQ()&&i.get_$3HQ().length){r.$2zF("RetrieveCertsForSmimeEncryption",i.get_$3HQ().length+" recipients have no cert. Details:");for(var u=0;u<i.get_$3HQ().length;u++){var o=i.get_$3HQ()[u];o&&r.$2zF("RetrieveCertsForSmimeEncryption",r.$7nH(f.get_$E(u))+": "+r.$7nE(o))}var s=function(){r.$6o("RetrieveCertsForSmimeEncryption","Retry callback");r.$3bS.set_$1C(!1);r.$9PI(n,t)};r.$3bS.$3e(i.$3X,i.get_$3HQ(),s,n,t);r.$3bS.set_$1C(!0)}else{r.$6o("RetrieveCertsForSmimeEncryption","Retrieving certs completed. Count = "+e.length);n()}else{r.$2zF("RetrieveCertsForSmimeEncryption","All recipients have no cert.");r.$4PO(_u.Strings.l_Smime_CannotEncrypt_Text,741);t()}},function(){u.$2zF("RetrieveCertsForSmimeEncryption","Retrieving certs failed. "+i.$2H.message);if(_a.$2f.$1UJ(i.$2H)){_a.$2f.$1Ha(i.$2H,14);u.$1iz(i.$2H)}else{_js.Trace.logException(_a.$0.$53,i.$2H,"GetCerts action failed.");u.$4PO(_u.Strings.l_Smime_CannotEncrypt_Text,729)}t()},function(){if(i.get_$3nN()&&i.get_$3nN().length>0){e.$2zF("RetrieveCertsForSmimeEncryption",i.get_$3nN().length+" errors occurred in GetCerts OWS call:");for(var n=0;n<i.get_$3nN().length;n++)e.$4KH("RetrieveCertsForSmimeEncryption","#"+n+": "+i.get_$3nN()[n])}})},$7nE:function(n){if(!n||!n.length)return"";for(var i=new Array(n.length),t=0;t<n.length;t++)i[t]=this.$7nH(n[t]);return i.join("; ")},$7nH:function(n){if(n){var i=n.Name||n.OriginalDisplayName||"_";var t=(n.EmailAddress||"_")+"|"+(n.MailboxType||"_")+"|"+(n.RoutingType||"_");return i+" <"+t+">"}else return"_"},$5oM:function(){this.$6o("BuildSmimeContentAndSend","Executing BuildSmimeContent");var t=this,n=this;this.$333(this.$5pY,2,function(){t.$6o("BuildSmimeContentAndSend","Executing proceed callback to send message");t.$73t()},function(){n.$6o("BuildSmimeContentAndSend","Executing cancel callback to cancel send");n.$4UL()})}};_smim.$1Qk=function(){_smim.$1Qk.initializeBase(this,["SmimeItemAttachmentPopOutViewModelCommand"])};_smim.$1Qk.prototype={$5Y0:null,$5ud:null,$7C8:null,$3e:function(n,t,i){_a.$4.$z(n,"showErrorMessageAndCloseWindowCallback");_a.$4.$z(t,"createItemReadingPaneViewModelCallback");_a.$4.$z(i,"setItemAttachmentCategoryCallback");this.$5Y0=n;this.$5ud=t;this.$7C8=i},$9Iw:function(n){var i=window.opener.getSmimeCachedContent(n);if(!i){this.$4KH("ProcessSmimeItemAttachment",String.format("Cannot get attachment content of {0} from window.opener.",n));this.$5Y0();return}var u=i[0];var r=i[1];this.$6o("ProcessSmimeItemAttachment","Start to parse MIME content of a ItemAttachment into Message.");var t=this;_a.$c.$1A9.$AOs(r,function(n){var o=JsonParser.deserialize(n);if(o.ErrorCode){var s=_a.$2f.$9("The MIME content of the item attachment can't be parsed.",o.ErrorCode);_js.Trace.logException(_a.$0.$53,s,s.message);t.$5Y0()}else{var e=o.Data;t.$6o("ProcessSmimeItemAttachment","MIME content of the ItemAttachment has been parsed into Message.");var h=e;h.DateTimeReceived=u;var c=e;c.ItemCategory=1;var f=new _g.$5w(h);f.$8dc(e);if(f.get_$1UI()){t.$6o("ProcessSmimeItemAttachment","Adding p7m attachment.");var i=new _g.$J7;i.AttachmentId=new _g.$DC(_a.$c.$2rG());i.Name="smime.p7m";i.ContentType="application/x-pkcs7-mime";i.Content=_a.$5u.$Jh(r);f.get_$5U().Attachments=[i]}t.$7C8(1);t.$5ud(f)}})}};_smim.$1Qg=function(){_smim.$1Qg.initializeBase(this,["SmimeAttachmentViewModelCommand"])};_smim.$1Qg.prototype={$1w:null,$3e:function(n){_a.$4.$z(n,"attachment");this.$1w=n},$A3R:function(){var n=null;this.$6o("AddItemAttachmentMimeContentToCache",String.format("Executing for attachment {0}.",this.$1w.get_$1x()));if(_g.$7d.isInstanceOfType(this.$1w)){this.$6o("AddItemAttachmentMimeContentToCache",String.format("Attachment {0} is ItemAttachment.",this.$1w.get_$1x()));n=this.$1w.get_$c4()}else if(_g.$7R.isInstanceOfType(this.$1w)){this.$6o("AddItemAttachmentMimeContentToCache",String.format("Attachment {0} is ItemIdAttachment.",this.$1w.get_$1x()));n=this.$1w.get_$c4()}else _a.$4.$1Op("AddItemAttachmentMimeContentToCache should only be called for ItemAttachment or ItemIdAttachment");this.$6o("AddItemAttachmentMimeContentToCache",String.format("Adding mime for item attachment {0} to cache.",this.$1w.get_$1x()));_a.$c.$ABC(this.$1w.get_$6J().Id,[this.$1w.get_$Jb().DateTimeReceived,n])},$E6M:function(){var i=null;this.$6o("SaveAttachmentFile",String.format("Executing for attachment {0}.",this.$1w.get_$1x()));if(this.$1w.get_$X8())i=_g.$54.isInstanceOfType(this.$1w)?this.$1w.get_$DY():this.$1w.get_$c4();else if(this.$1w.get_$23p()){var e=this.$1w;i=e.get_$DY()}else _a.$4.$1Op("SaveAttachmentFile should only be called if IsSmimeTemporary or IsSmimeDecoded");try{if(window.Blob){var r=_a.$5u.$ALS(i,this.$1w.get_$KN());if(navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob(r,this.$1w.get_$1x())){this.$6o("SaveAttachmentFile",String.format("S/MIME attachment {0} is saved using navigator.msSaveOrOpenBlob function.",this.$1w.get_$1x()));return}var f=window.saveAs||window.webkitSaveAs||window.mozSaveAs;if(f&&f(r,this.$1w.get_$1x())){this.$6o("SaveAttachmentFile",String.format("S/MIME attachment {0} is saved using window.saveAs function.",this.$1w.get_$1x()));return}var u=window.URL||window.webkitURL;var t=document.createElement("a");if(u&&t.download!==undefined){t.href=u.createObjectURL(r,null);t.download=this.$1w.get_$1x();var n=document.createEvent("MouseEvent");n.initMouseEvent("click",!1,!1,window.self,0,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,0,null);t.dispatchEvent(n);t=null;this.$6o("SaveAttachmentFile",String.format("S/MIME attachment {0} is saved using <a download> tag.",this.$1w.get_$1x()));return}}else{_a.$c.$1A9.$1Pp.SaveFile(this.$1w.get_$1x(),i);this.$6o("SaveAttachmentFile",String.format("S/MIME attachment {0} is saved using plugin.SaveFile function.",this.$1w.get_$1x()))}}catch(o){this.$4KH("SaveAttachmentFile",String.format("S/MIME attachment {0} cannot be saved. Both browser and plugin does not support saving file. Error: {1}",this.$1w.get_$1x(),o.message))}}};_smim.$hj=function(){this.$$d_$BxC=Function.createDelegate(this,this.$BxC);this.$$d_$gB=Function.createDelegate(this,this.$gB);_smim.$hj.initializeBase(this,["SmimeAttachmentWellViewModelCommand"])};_smim.$hj.$9g9=function(n){n.get_$9P().set_$6J(new _g.$DC(_a.$c.$2rG()));n.get_$9P().set_$az(null)};_smim.$hj.prototype={$4S1:null,$477:0,$1xA:null,$6wF:null,$7C6:null,$7Bj:null,$6vg:null,$6vf:null,$5kV:null,$6wG:null,$4Al:null,$5xz:null,$5jF:null,$63Z:null,$6zE:null,$5Mo:null,$5qb:null,$6Fa:null,$6Nm:null,$6Mo:null,$7NU:null,$5f:null,$99:null,$1d:null,$3e:function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){_a.$4.$z(n,"attachmentWellViewModel");_a.$4.$z(t,"contextId");_a.$4.$z(i,"infoBarViewModel");_a.$4.$z(r,"queueAttachmentForOperationCallback");_a.$4.$z(u,"setInlineImagePlaceHolderIdCallback");_a.$4.$z(f,"setCurrentlyInProgressAttachmentCallback");_a.$4.$z(e,"processNextAttachmentPostProcessingCallback");_a.$4.$z(o,"processNextAttachmentCallback");_a.$4.$z(s,"addToFileNamesCallback");_a.$4.$z(h,"queueAttachmentForUploadCallback");_a.$4.$z(c,"queueAttachmentForDeleteCallback");_a.$4.$z(l,"deletePlaceholderImageCallback");_a.$4.$z(a,"addAttachmentFailureListMessageToInfobarCallback");_a.$4.$z(v,"fireVisibilityChangeEventCallback");_a.$4.$z(y,"replacePlaceholderImageCallback");_a.$4.$z(p,"replaceInlineImageWithPlaceholderCallback");_a.$4.$z(p,"replaceInlineImageWithPlaceholderCallback");_a.$4.$z(w,"checkAndErrorOnSizeAndNumberOfAttachmentsCallback");_a.$4.$z(b,"getAttachmentViewModelCollectionCallback");_a.$4.$z(k,"insertImagePlaceholderCallback");_a.$4.$z(d,"incrementTotalSizeCallback");_a.$4.$z(g,"updateShouldBeHiddenFlagAndFireCollectionChangedEventsCallback");this.$5f=n;this.$99=t;this.$1d=i;this.$6wF=r;this.$7C6=u;this.$7Bj=f;this.$6vg=e;this.$6vf=o;this.$5kV=s;this.$6wG=h;this.$4Al=c;this.$5xz=l;this.$5jF=a;this.$63Z=v;this.$6zE=y;this.$5Mo=p;this.$5qb=w;this.$6Fa=b;this.$6Nm=k;this.$6Mo=d;this.$7NU=g;this.$8P7()},$2qx:function(){if(!this.$5f.get_$1m()||!this.$5f.get_$1m().get_$A()){this.$6o("MoveAttachmentsFromServerToClient","No attachments to move.");return}var n=this;this.$5f.get_$1m().$Cj(function(t){var u=t;var i=u.get_$9P();var r=n.$3sH(i);n.$6o("MoveAttachmentsFromServerToClient",String.format("Moving attachment {0}",r));if(i.get_$23p()||i.get_$2mt()||_g.$7i.isInstanceOfType(i)){n.$6o("MoveAttachmentsFromServerToClient",String.format("Skipping attachment because IsSmimeTemporary or IsSmimeDataPackage or ReferenceAttachment. Attachment {0}",r));return}var f;if(_g.$54.isInstanceOfType(i)){n.$6o("MoveAttachmentsFromServerToClient",String.format("Preparing file attachment. Attachment {0}",r));var s=i;f=s.get_$DY()}else if(_g.$7d.isInstanceOfType(i)){n.$6o("MoveAttachmentsFromServerToClient",String.format("Preparing item attachment. Attachment {0}",r));var h=i;f=h.get_$c4()}else{n.$6o("MoveAttachmentsFromServerToClient",String.format("Preparing itemId attachment. Attachment {0}",r));var e=i;f=e.get_$c4()}i.set_$az(i.get_$6J());i.set_$6J(null);if(n.$5f.get_$F7()){u.set_$1Lf(!0);n.$6o("MoveAttachmentsFromServerToClient",String.format("ParentItemId != null. Attachment {0}",r));if(f){if(i.get_$az()&&i.get_$az().Id&&!i.get_$az().Id.startsWith("smime-")){if(i.get_$CA()&&_g.$54.isInstanceOfType(i)){n.$6o("MoveAttachmentsFromServerToClient",String.format("Replace inline file attachment with placeholder. Attachment {0}",r));var o=i;u.set_$om(n.$5Mo(o.get_$SF()));_js.$D.get_$Q().$2V(_a.$0.$16,"ReplacePlaceholderImageWithContent",function(){n.$5Mp(u)},500)}n.$6o("MoveAttachmentsFromServerToClient",String.format("Queue attachment for delete from server. Attachment {0}",r));n.$4Al(u)}}else{n.$6o("MoveAttachmentsFromServerToClient",String.format("Content == null. Queue attachment for download. Attachment {0}",r));n.$6wE(u,!1)}}else if(f){n.$6o("MoveAttachmentsFromServerToClient",String.format("ParentId == null and content != null, Set attachment id & clear temp id. Attachment {0}",r));_smim.$hj.$9g9(u);if(u.get_$9P().get_$CA()){n.$6o("MoveAttachmentsFromServerToClient",String.format("ParentId == null and content != null and IsInline, Replace inline image with content. Attachment {0}",r));u.set_$om(n.$5Mo(u.get_$9P().get_$SF()));n.$5Mp(u)}}else{n.$6o("MoveAttachmentsFromServerToClient",String.format("ParentId == null and content == null, Queue attachment for download. Attachment {0}",r));n.$6wE(u,!1)}})},$2qw:function(){if(!this.$5f.get_$1m()||!this.$5f.get_$1m().get_$A()){this.$6o("MoveAttachmentsFromClientToServer","No attachments to move.");return}var n=this;this.$5f.get_$1m().$Cj(function(t){var u=t;var i=u.get_$9P();var r=n.$3sH(i);n.$6o("MoveAttachmentsFromClientToServer",String.format("Moving attachment {0}",r));if(i.get_$2mt()&&i.get_$6J()&&i.get_$6J().Id&&!i.get_$23p()){n.$6o("MoveAttachmentsFromClientToServer",String.format("Queue attachment for delete since IsSmimeDataPackage. Attachment {0}",r));n.$4Al(u);return}else if(!i.get_$23p()||_g.$7i.isInstanceOfType(i)){n.$6o("MoveAttachmentsFromClientToServer",String.format("Skip attachment since !IsTemporary or ReferenceAttachment. Attachment {0}",r));return}else if(_g.$54.isInstanceOfType(i)){n.$6o("MoveAttachmentsFromClientToServer",String.format("FileAttachment. Attachment {0}",r));var f=i}else _g.$7d.isInstanceOfType(i)?n.$6o("MoveAttachmentsFromClientToServer",String.format("ItemAttachment. Attachment {0}",r)):n.$6o("MoveAttachmentsFromClientToServer",String.format("ItemIdAttachment. Attachment {0}",r));i.set_$az(i.get_$6J());i.set_$6J(null);u.set_$1Lf(!0);n.$6o("MoveAttachmentsFromClientToServer",String.format("Queue attachment for upload. Attachment {0}",r));n.$6wG(u)})},$5GS:function(n){if(!this.$5qb()){this.$6o("OpenSmimeFilePicker","Exiting because size or number of attachments exceeds limits.");return}var i=_a.$c.$4AK(!0);if(i){this.$1d.$2D5(i);if(!_a.$2f.$3zQ(i)){this.$6o("OpenSmimeFilePicker","Exiting due to exception: "+i.message);return}}this.$6o("OpenSmimeFilePicker","Calling plugin open file");var s=n?_a.$c.$1A9.$1Pp.OpenImageFile():_a.$c.$1A9.$1Pp.OpenFile();if(_js.$9.$o(s)){this.$6o("OpenSmimeFilePicker","No files selected. Exiting.");return}for(var l=JsonParser.deserialize(s),v=this.$6Fa(),o=new(_ff.$18.$$(_y.$OU)),h=l,a=h.length,f=0;f<a;++f){var r=h[f];var t=new _g.$54;t.set_$6J(new _g.$DC(_a.$c.$2rG()));t.set_$CA(n);var e=t.get_$6J().Id;this.$6o("OpenSmimeFilePicker",String.format("Creating AttachmentViewModel. Attachment {0}",e));t.set_$1x(r.Name);t.set_$8D(r.Size);t.set_$KN(r.ContentType);t.set_$DY(r.Content);var u=this.$5f.$ALL(t,!1,!1);v.$F(u);if(n){this.$6o("OpenSmimeFilePicker",String.format("Insert image placeholder for inline attachment. Attachment {0}",e));u.set_$om(this.$6Nm(t.get_$1x()));o.$F(u)}this.$6Mo(t.get_$8D())}if(n){this.$6o("OpenSmimeFilePicker","Queue timer callback for replace placeholder image with content.");var c=this;_js.$D.get_$Q().$2V(_a.$0.$16,"ReplacePlaceholderImageWithContent",function(){for(var i=o.get_$1y(),r=i.length,n=0;n<r;++n){var t=i[n];t.get_$9P().set_$SF("image"+_a.$c.$94O());c.$5Mp(t)}},500)}else{this.$6o("OpenSmimeFilePicker","Update should be hidden flag and collection change events.");this.$7NU()}},$3US:function(n){n.get_$9P().set_$az(new _g.$DC(_a.$c.$2rG()));this.$6wE(n,!0)},$3sH:function(n){var t;t=n.get_$6J()&&n.get_$6J().Id?n.get_$6J().Id:"<null>";return t},$6wE:function(n,t){var i=this.$3sH(n.get_$9P());this.$6o("QueueAttachmentForDownload",String.format("Starting. Attachment {0}",i));if(n.get_$9P().get_$CA()){this.$6o("QueueAttachmentForDownload",String.format("Set inline image placeholder id. Attachment {0}",i));this.$7C6(n,t)}this.$1xA||(this.$1xA=[]);this.$6o("QueueAttachmentForDownload",String.format("Queue download. Attachment {0}",i));this.$6wF(n,this.$1xA,this.$$d_$gB)},$gB:function(){this.$6o("ProcessNextAttachment","Starting.");if(this.$1xA&&this.$1xA.length>0){var n=Array.dequeue(this.$1xA);var t=this.$3sH(n.get_$9P());this.$6o("ProcessNextAttachment",String.format("Set currently in progress attachment. Attachment {0}",t));this.$7Bj(n);n.add_$97o(this.$$d_$BxC);this.$6o("ProcessNextAttachment",String.format("Download. Attachment {0}",t));n.$1l4();this.$6o("ProcessNextAttachment",String.format("Post processing. Attachment {0}",t));this.$6vg()}else{this.$6o("ProcessNextAttachment","Call ProcessNextAttachmentCallback.");this.$6vf()}},$BxC:function(n){var t=n;var i=this.$3sH(t.get_$9P());this.$6o("HandleAttachmentViewModelDownloadComplete",String.format("Starting. Attachment {0}",i));t.remove_$97o(this.$$d_$BxC);if(t.get_$1ao()===this.$99){this.$6o("HandleAttachmentViewModelDownloadComplete",String.format("ContextId matches. Attachment {0}",i));if(t.get_$3Sn()){this.$6o("HandleAttachmentViewModelDownloadComplete",String.format("Operation failed, Adding to download failed names. Attachment {0}",i));t.get_$9P().set_$6J(t.get_$9P().get_$az());t.get_$9P().set_$az(null);t.set_$1Lf(!1);this.$5kV(this.$4S1,t.get_$9P().get_$1x());this.$477++}else if(t.get_$1Lf()){this.$6o("HandleAttachmentViewModelDownloadComplete",String.format("IsMoving: Queuing attachment for delete since download completed. Attachment {0}",i));this.$4Al(t)}else{this.$6o("HandleAttachmentViewModelDownloadComplete",String.format("SetAttachmentIdClearTemporaryId. Attachment {0}",i));_smim.$hj.$9g9(t)}if(t.get_$9P().get_$CA())if(t.get_$3Sn()){this.$6o("HandleAttachmentViewModelDownloadComplete",String.format("IsInline, download failed: DeletePlaceHolderImage. Attachment {0}",i));this.$5xz(t.get_$om())}else{_js.$9.$o(t.get_$9P().get_$SF())&&t.get_$9P().set_$SF("image"+_a.$c.$94O());this.$6o("HandleAttachmentViewModelDownloadComplete",String.format("IsInline: ReplacePlaceHolderImage with content. Attachment {0}",i));this.$5Mp(t)}if((!this.$1xA||!this.$1xA.length)&&this.$477>0){this.$6o("HandleAttachmentViewModelDownloadComplete","Show download failures.");this.$5jF(661,671,this.$4S1,this.$477);this.$63Z();this.$8P7()}this.$6o("HandleAttachmentViewModelDownloadComplete","ProcessNextAttachment.");this.$gB()}},$8P7:function(){this.$4S1=new Sys.StringBuilder;this.$477=0},$5Mp:function(n){this.$6o("ReplacePlaceholderImageWithContent","Starting.");var t=n.get_$9P();var i="data:"+t.get_$KN()+";base64,"+t.get_$DY();this.$6zE(n.get_$om(),i,t.get_$SF())}};_smim.$1Qn=function(){_smim.$1Qn.initializeBase(this,["SmimeMailResponseViewModelCommand"])};_smim.$1Qn.prototype={$2oB:null,$d:null,$5uR:null,$5vG:null,$3e:function(n,t,i,r){_a.$4.$z(n,"mailResponseViewModel");_a.$4.$z(t,"userConfiguration");_a.$4.$z(i,"createGetCalendarItemActionCallback");_a.$4.$z(r,"createReplyForwardHeaderStringCallback");this.$2oB=n;this.$d=t;this.$5uR=i;this.$5vG=r},$Eu5:function(n,t,i){if(_g.$2g.isInstanceOfType(t)){var r=t;r.get_$1Lb()?this.$5ef(n,t,i):this.$Bnk(n,r,i)}else t.get_$X8()||t.get_$Mq()?this.$5ef(n,t,i):this.$BqT(n,t,i)},$BqT:function(n,t,i){this.$6o("GetNormalizedBody","The original item's NormalizedBody is not available, fetch it now.");var r=new _h.$Fz(200,[t.get_$y()],_h.$f.get_$1Ls(),"ItemNormalizedBody",2,!1);r.$99=n.get_$D1();var f=this;r.add_$2b(function(){f.$6o("GetNormalizedBody","The original item's NormalizedBody cannot be retrieved.");n.set_$4IE(30)});var u=this;r.add_$4Q(function(){u.$5ef(n,t,i)});OwaApplication.$2B.$1U(r)},$Bnk:function(n,t,i){this.$6o("GetFullCalendarItem","The original calendar item isn't fully loaded, get it now.");var u=this.$5uR(t,n);var r=u;var e=this;r.add_$2b(function(){e.$6o("GetFullCalendarItem","The original calendar item cannot be fully loaded.");n.set_$4IE(30)});var f=this;r.add_$4Q(function(){f.$5ef(n,u.get_$8t(),i)});OwaApplication.$2B.$1U(r)},$5ef:function(n,t,i){var r=n.get_$6P()==="HTML";this.$EVt(n,t,r,i);this.$EVl(n,t,r,i);n.set_$OV(!0);_js.Trace.logInfo(_a.$0.$53,"S/MIME context upgrading completed.");_a.$6.acsa(_a.$0.$16,"VM.MailCompose.Navigate");this.$2oB.get_$5F().$WM(n)},$EVt:function(n,t,i,r){var u;if(t.get_$t9())u=t.get_$t9().get_$1Z();else{var f=t.get_$Mq()||t.get_$4n()||t.get_$S7();if(f)u=i?f.get_$1Z():this.$Bud(f);else{_js.Trace.logError(_a.$0.$53,"The body of original message is not available.");u=""}}i&&(u=_a.$37.$E1Z(u));var e=this.$5vG(i,t,r);n.set_$do(this.$AAo(i,u,e));n.set_$Xa(!1)},$EVl:function(n,t,i,r){_a.$c.$43&&t.get_$Mk()?n.set_$EW(this.$8Go(i,t.get_$1Aw(),r)):n.set_$EW(this.$8Go(i,t.get_$1m(),r))},$Bud:function(n){var t=n.get_$1Z();if(n.get_$6P()==="Text")return t;else{t=t.replace(new RegExp("<img[\\s\\S]*?>|<image[\\s\\S]*?>","gim"),"[X]");t=t.replace(new RegExp("</img>|</image>","gim"),"");var i=document.createElement("p");i.innerHTML=t;t=i.innerText||i.textContent;i=null;return t}},$AAo:function(n,t,i){var o=this.$d.get_$1j();var e=o.get_$qc()?(n?o.get_$1Hm():o.get_$1Ya())||"":"";if(n){var r=_a.UserAgent.getInstance().$Ec?"<P></P>":"<P><BR></P>";i=_js.$9.$o(e)?r+r+i:r+r+e+r+i;var u=t.indexOf("<body");if(u<0)return i+t;else{while(u<t.length&&t.charAt(u++)!==">");t=t.substring(0,u)+i+t.substring(u,t.length);return t}}else{var f="\n";i=_js.$9.$o(e)?f+i:f+f+e.trim()+f+i;return i+t}},$8Go:function(n,t,i){if(!t||!t.get_$A())return null;if(i===3){var u=new _js.$X;var e=this;t.$Cj(function(n){var t=n;t=t.$4s();u.$F(t)});return u.get_$A()>0?u:null}else if(i===1||i===2){var r=new _js.$X;var f=this;t.$Cj(function(t){if(_g.$54.isInstanceOfType(t)&&t.get_$CA()&&n){var i=t;i=i.$4s();r.$F(i)}});return r.get_$A()>0?r:null}else return null}};_smim.$xM=function(n){this.$$d_$F04=Function.createDelegate(this,this.$F04);this.$$d_$F05=Function.createDelegate(this,this.$F05);this.$$d_$Efj=Function.createDelegate(this,this.$Efj);_smim.$xM.initializeBase(this);this.$4IK=_a.$6.$1g(_a.$0.$53,"SMIMESignatureValidation",!0);this.$Cw=n;this.$b=n.get_$Ca();this.$4I1=new _smim.$pk(this.$b);this.$7FR=new _C(this.$$d_$Efj,_a.$0.$GU);if(this.$b.get_$tA().IsCertValidToServer){this.$7Mq();_a.$6.$1G(this.$4IK,"SMIMESignatureValidation","",null)}else{var t=new _h.$ld(200,this.$b.get_$tA().CertRawData,!1);t.add_$2s(this.$$d_$F05);t.add_$2b(this.$$d_$F04);OwaApplication.$2B.$1U(t);this.$3V=_u.Strings.l_Smime_SignatureVerifying_Text;this.$3zM=!0}};_smim.$xM.prototype={$b:null,$Cw:null,$NF:null,$3V:null,$3zM:!1,$4I1:null,$7FR:null,$4IK:null,set_$BI:function(n){if(n!==this.$NF){this.$NF=n;this.$4("ImageId")}return n},set_$1K:function(n){n=n+" "+_u.Strings.l_ForMoreInformation_Text+" ";if(n!==this.$3V){this.$3V=n;this.$4("Text")}return n},set_$CGG:function(n){if(n!==this.$3zM){this.$3zM=n;this.$4("IsVerifying")}return n},$F05:function(n){var t=n;if(t.get_$4d().IsValid){this.$b.get_$tA().ServerVerificationResult=0;this.$b.get_$tA().IsCertValidToServer=!0}else{var i=t.get_$4d().PolicyFlag;this.$b.get_$tA().ServerVerificationResult=i;this.$b.get_$tA().IsCertValidToServer=!1}this.$7Mq();_a.$6.$1G(this.$4IK,"SMIMESignatureValidation","",null)},$F04:function(n){this.$7Mq();this.$Cw.$2tT(n.$2H);_a.$6.$1G(this.$4IK,"SMIMESignatureValidation",n.$2H.message,null)},$7Mq:function(){if(this.$b.get_$8X5()){this.set_$BI(_n.$1.get_$4CL());!this.$b.get_$tA().CertIssuedTo||this.$b.get_$tA().CertIssuedTo.indexOf("=")>=0?this.set_$1K(_u.Strings.l_Smime_SignatureValid_Text):this.set_$1K(String.format(_u.Strings.l_Smime_SignatureSignerValid_Text,this.$b.get_$tA().CertIssuedTo))}else{this.set_$BI(_n.$1.get_$r1());this.set_$1K(_u.Strings.l_Smime_SignatureInvalid_Text)}this.set_$CGG(!1)},$Efj:function(){this.$4I1.$3e();this.$4I1.set_$1C(!0)}};_smim.$pk=function(n){_smim.$pk.initializeBase(this);this.$b=n;this.set_$FD(this);var t=new _js.$X;t.$F(new _ff.$1l(this.$5a,_bcs.BootCommonStrings.l_OK_Text));this.set_$Wr(t);this.$3bL=new _js.$X};_smim.$pk.prototype={$b:null,$3bL:null,get_$AEH:function(){return _js.$9.$5K(_u.Strings.l_Smime_CertIssuedTo_Text,this.$b.get_$tA().CertIssuedTo)},get_$AEG:function(){return _js.$9.$5K(_u.Strings.l_Smime_CertIssuedBy_Text,this.$b.get_$tA().CertIssuedBy)},get_$AEI:function(){return _js.$9.$5K(_u.Strings.l_Smime_CertValidFromTo_Text,this.$b.get_$tA().CertValidFrom,this.$b.get_$tA().CertValidTo)},get_$E7y:function(){return this.$b.get_$8X5()?_u.Strings.l_Smime_SignatureValid_Text:_u.Strings.l_Smime_SignatureInvalid_Text},get_$Efk:function(){return this.$3bL.get_$A()>0},$3e:function(){var n=this.$Bmu(this.$b.get_$Eiz());this.$3bL.$1u();n&&this.$3bL.$3y(n)},$Bmu:function(n){if(n){if(n===-1)return[new SmimeSignatureError(n,_u.Strings.l_Smime_CertDataCorrupted_Text)]}else return null;var t=new(_ff.$18.$$(SmimeSignatureError));(n&1)==1&&t.$F(new SmimeSignatureError(1,_u.Strings.l_Smime_SignatureError_NotTimeValid_Text));(n&2)==2&&t.$F(new SmimeSignatureError(2,_u.Strings.l_Smime_SignatureError_NotTimeNested_Text));(n&4)==4&&t.$F(new SmimeSignatureError(4,_u.Strings.l_Smime_SignatureError_Revoked_Text));(n&8)==8&&t.$F(new SmimeSignatureError(8,_u.Strings.l_Smime_SignatureError_NotSignatureValid_Text));(n&16)==16&&t.$F(new SmimeSignatureError(16,_u.Strings.l_Smime_SignatureError_NotValidForUsage_Text));(n&32)==32&&t.$F(new SmimeSignatureError(32,_u.Strings.l_Smime_SignatureError_UntrustedRoot_Text));(n&64)==64&&t.$F(new SmimeSignatureError(64,_u.Strings.l_Smime_SignatureError_RevocationStatusUnknown_Text));(n&128)==128&&t.$F(new SmimeSignatureError(128,_u.Strings.l_Smime_SignatureError_Cyclic_Text));(n&256)==256&&t.$F(new SmimeSignatureError(256,_u.Strings.l_Smime_SignatureError_InvalidExtension_Text));(n&512)==512&&t.$F(new SmimeSignatureError(512,_u.Strings.l_Smime_SignatureError_InvalidPolicyConstraints_Text));(n&1024)==1024&&t.$F(new SmimeSignatureError(1024,_u.Strings.l_Smime_SignatureError_InvalidBasicConstraints_Text));(n&2048)==2048&&t.$F(new SmimeSignatureError(2048,_u.Strings.l_Smime_SignatureError_InvalidNameConstraints_Text));(n&4096)==4096&&t.$F(new SmimeSignatureError(4096,_u.Strings.l_Smime_SignatureError_HasNotSupportedNameConstraint_Text));(n&8192)==8192&&t.$F(new SmimeSignatureError(8192,_u.Strings.l_Smime_SignatureError_HasNotDefinedNameConstraint_Text));(n&16384)==16384&&t.$F(new SmimeSignatureError(16384,_u.Strings.l_Smime_SignatureError_HasNotPermittedNameConstraint_Text));(n&32768)==32768&&t.$F(new SmimeSignatureError(32768,_u.Strings.l_Smime_SignatureError_HasExcludedNameConstraint_Text));(n&65536)==65536&&t.$F(new SmimeSignatureError(65536,_u.Strings.l_Smime_SignatureError_PartialChain_Text));(n&131072)==131072&&t.$F(new SmimeSignatureError(131072,_u.Strings.l_Smime_SignatureError_CtlNotTimeValid_Text));(n&262144)==262144&&t.$F(new SmimeSignatureError(262144,_u.Strings.l_Smime_SignatureError_CtlNotSignatureValid_Text));(n&524288)==524288&&t.$F(new SmimeSignatureError(524288,_u.Strings.l_Smime_SignatureError_CtlNotValidForUsage_Text));(n&16777216)==16777216&&t.$F(new SmimeSignatureError(16777216,_u.Strings.l_Smime_SignatureError_OfflineRevocation_Text));(n&33554432)==33554432&&t.$F(new SmimeSignatureError(33554432,_u.Strings.l_Smime_SignatureError_NoIssuanceChainPolicy_Text));return t.get_$1y()}};_smim.$1Qh=function(){};_smim.$1Qh.prototype={$7hB:function(){return new _smim.$hk},$7h7:function(){return new _smim.$1Qk},$ALM:function(){return new _smim.$1Qg},$5tt:function(){return new _smim.$hj},$AOh:function(){return new _smim.$1Qn},$7hA:function(){return new _smim.$1Ql}};_smim.$hk=function(){this.$$d_$5xB=Function.createDelegate(this,this.$5xB);this.$$d_$7je=Function.createDelegate(this,this.$7je);this.$$d_$7jf=Function.createDelegate(this,this.$7jf);_smim.$hk.initializeBase(this,["SmimeItemReadingPaneViewModelCommand"])};_smim.$hk.$8TO=function(n,t){var i=n.$b;return i.get_$y().Id===t.get_$y().Id};_smim.$hk.prototype={$b:null,$35Z:null,$6vU:null,$7CE:null,$6Qb:null,$4df:null,$627:null,$1d:null,$3e:function(n,t,i,r,u,f,e,o){_a.$4.$z(n,"item");_a.$4.$z(t,"createItemViewModelCallback");_a.$4.$z(i,"processActionErrorCallback");_a.$4.$z(r,"setLoadingCallback");_a.$4.$z(u,"isGetItemActionForCurrentItemCallback");_a.$4.$z(f,"executeOnLoadItemSuccessCallback");_a.$4.$z(e,"executeOnLoadItemFailureCallback");_a.$4.$z(o,"infoBarViewModel");this.$b=n;this.$35Z=t;this.$6vU=i;this.$7CE=r;this.$6Qb=u;this.$4df=f;this.$627=e;this.$1d=o},$5CL:function(n){_a.$c.$43&&this.$b.get_$Mk()||_a.$4.$1Op("Smime is not enabled or the item's class is not smime");if(this.$b.get_$X8()){this.$6o("NeedToFetchItem","Item already decoded - returning false");return!1}if(_a.$c.get_$18l()){var t=!this.$b.get_$t9();this.$6o("NeedToFetchItem",String.format("HasSmimeDataPackage {0} IsSmimeNormalizedBodyNull {1}",this.$b.get_$3G0(),t));return!this.$b.get_$3G0()&&t}this.$6o("NeedToFetchItem",String.format("Returning default value {0}",n));return n},$5xB:function(){this.$6o("DecodeAndCreateItemViewModel","Executing");var n=_a.$c.$4AK(this.$b.get_$3G0(),!1,!1,!1,this.$b.get_$1UI()||this.$b.get_$3yz());if(n&&_a.$2f.$3zQ(n)){this.$6o("DecodeAndCreateItemViewModel","Adding smime infobar warning: "+n.message);this.$1d.$2D5(n);n=null}if(this.$b.get_$t9()){this.$6o("DecodeAndCreateItemViewModel","Normalized body is non-null, calling CreateItemViewModel");this.$35Z()}else if(n){this.$6o("DecodeAndCreateItemViewModel","Adding smime infobar error: "+n.message);_a.$2f.$1Ha(n,this.$b.get_$1UI()?11:12);this.$6vU(n);this.$35Z()}else{this.$6o("DecodeAndCreateItemViewModel","Normalized body is null, submitting DecodeSmimeMessageAction");var t=new _h.$sT(200,this.$b);t.add_$2s(this.$$d_$7jf);t.add_$2b(this.$$d_$7je);this.$7CE(!0);OwaApplication.$2B.$1U(t)}},$4o4:function(n){this.$6o("GetItemSucceededCallback","Executing");this.$4df(n,this.$6Qb,this.$$d_$5xB)},$7iB:function(n){this.$6o("CreateSenderSignatureViewModel","Executing");return new _smim.$xM(n)},$7jf:function(n){this.$6o("DecodeSmimeMessageSucceededCallback","Executing");this.$4df(n,_smim.$hk.$8TO,this.$35Z)},$7je:function(n){this.$6o("DecodeSmimeMessageFailedCallback","Executing");var t=this;this.$627(n,_smim.$hk.$8TO,function(){_a.$2f.$1Ha(n.$2H,t.$b.get_$1UI()?11:12);t.$35Z()})}};function SmimeComponent(){}SmimeComponent.prototype={$2FT:function(n,t,i){var u=this;n.$r(ISmimeCommandFactory).$t(function(){return new _smim.$1Qh});var r=this;n.$r(IComponentOverrideFactory).$t(function(){return new _smim.$1Qi})},$Bl2:function(){return null}};_smim._TI=function(){};_smim._TI.$$cctor=function(){var r="SenderSignatureView._tid1";new _A(r,function(){_smim._TI.$1[r]===undefined&&(_smim._TI.$1[r]=[[[-1,4,null,null,null,"Text",null,_smim._TI.$H,0,null,null,null,_u.Strings.l_ClickHere_Text]]]);var n=_smim._TI._hf.childNodes[0].cloneNode(!0);var t=new _fc.$A(n.children[0]);return new _B(n,[t])},_smim.$xM,_fc.$1G,!1,!0,!1,0,_smim._TI.$1);var u="SenderSignatureView";new _A(u,function(){_smim._TI.$1[u]===undefined&&(_smim._TI.$1[u]=[[[-1,0,["ImageId"],[_smim._TI.$Ck6],null,"Id",null,_smim._TI.$14,1,null,null,null],[-1,0,["IsVerifying"],[_smim._TI.$6et],null,"IsHidden",null,_smim._TI.$8,1,null,null,!0]],[[-1,4,null,null,null,"SpinnerSize",null,_smim._TI.$5z,0,null,null,0,0],[-1,0,["IsVerifying"],[_smim._TI.$6et],null,"IsHidden",null,_smim._TI.$8,1,_smim._TI.get_$K(),null,!0]],[[-1,0,["Text"],[_smim._TI.$Ck8],null,"Text",null,_smim._TI.$H,1,null,null,null]],[[-1,0,["IsVerifying"],[_smim._TI.$6et],null,"IsHidden",null,_smim._TI.$8,1,null,null,!0],[-1,0,["ShowSignatureDetailsCommand"],[_smim._TI.$6eu],null,"ClickCommand",null,_smim._TI.$a,1,null,null,null]],[[-1,4,null,null,null,"DialogTitle",null,_smim._TI.$Dw,0,null,null,null,_u.Strings.l_Smime_SignatureInfo_Text],[-1,0,["SignatureDetailsViewModel"],[_smim._TI.$Ck7],null,"DataContext",null,_smim._TI.$Z,1,null,null,null],[0,0,["IsShown"],[_smim._TI.$9p],_smim._TI.$Dj,"IsShown",_smim._TI.$4w,_smim._TI.$4g,2,null,null,!1],[0,0,["CloseCommand"],[_smim._TI.$Eh],null,"CloseCommand",null,_smim._TI.$BV,1,null,null,null],[0,0,["FooterButtons"],[_smim._TI.$DS],null,"ButtonDataList",null,_smim._TI.$DT,1,null,null,null]]]);var n=_smim._TI._hf.childNodes[1].cloneNode(!0);var f=new _fce.$5M(n.children[4],_js.$2.Instance.$2(_fc.$l),_js.$2.Instance.$2(_ff.$M),_js.$2.Instance.$2(_ff.$C),_js.$2.Instance.$2(_ff.$J));f.set_$B1("SignatureDetailsView");var t=new _fc.$1G(n.children[3]);t.set_$g(0);var e=new _fc.$17;var i=new _fc.$N;i.$M(_E.$D(["ShowSignatureDetailsCommand"],[_smim._TI.$6eu],null,"Command",null,_smim._TI.$i,1));i.set_$Y("SPACE");var r=new _fc.$N;r.$M(_E.$D(["ShowSignatureDetailsCommand"],[_smim._TI.$6eu],null,"Command",null,_smim._TI.$i,1));r.set_$Y("ENTER");e.set_$2h([i,r]);t.set_$12([e]);t.set_$6("SenderSignatureView._tid1");var h=new _fc.$A(n.children[2]);var s=new _fce.$20(n.children[1],_js.$2.Instance.$2(_js.$p),_js.$2.Instance.$2(_ff.$C));var o=new _fc.$Y(n.children[0],_js.$2.Instance.$2(_ff.$C),_js.$2.Instance.$2(_ff.$J));return new _B(n,[o,s,h,t,f])},_smim.$xM,_js.$7,!1,!1,!1,0,_smim._TI.$1);var f="SignatureDetailsView.SmimeSignatureErrorTemplate";new _A(f,function(){_smim._TI.$1[f]===undefined&&(_smim._TI.$1[f]=[[[-1,0,["Message"],[_smim._TI.$CyP],null,"Text",null,_smim._TI.$H,1,null,null,null]]]);var n=_smim._TI._hf.childNodes[2].cloneNode(!0);var t=new _fc.$A(n.children[0]);return new _B(n,[t])},SmimeSignatureError,_fce.$22,!1,!1,!1,0,_smim._TI.$1);var n="SignatureDetailsView._tid2._tid3";new _A(n,function(){_smim._TI.$1[n]===undefined&&(_smim._TI.$1[n]=[null]);var i=_smim._TI._hf.childNodes[3].cloneNode(!0);var t=new _fce.$v(i.children[0]);return new _B(i,[t]).R({ListPanel:t})},_smim.$pk,_fce.$m,!1,!0,!1,0,_smim._TI.$1);var t="SignatureDetailsView._tid2";new _A(t,function(){_smim._TI.$1[t]===undefined&&(_smim._TI.$1[t]=[[[-1,4,null,null,null,"Text",null,_smim._TI.$H,0,null,null,null,_nbs.NonBootStrings.l_Smime_SignatureErrorDetails_Text]],[[-1,0,["SignatureErrors"],[_smim._TI.$CkE],null,"DataSource",null,_smim._TI.$2o,1,null,null,null]]]);var i=_smim._TI._hf.childNodes[4].cloneNode(!0);var n=new _fce.$m(_B.$3(i,[2,0]),_js.$2.Instance.$2(_ff.$C));n.set_$3Z("SignatureDetailsView.SmimeSignatureErrorTemplate");n.set_$6("SignatureDetailsView._tid2._tid3");var r=new _fc.$A(i.children[0]);return new _B(i,[r,n])},_smim.$pk,_js.$7,!1,!0,!1,0,_smim._TI.$1);var i="SignatureDetailsView";new _A(i,function(){_smim._TI.$1[i]===undefined&&(_smim._TI.$1[i]=[[[-1,4,null,null,null,"Text",null,_smim._TI.$H,0,null,null,null,_nbs.NonBootStrings.l_Smime_SecurityStatus_Text]],[[-1,0,["SecurityStatus"],[_smim._TI.$CkC],null,"Text",null,_smim._TI.$H,1,null,null,null]],[[-1,0,["ShowSignatureErrors"],[_smim._TI.$CkD],null,"IsHidden",null,_smim._TI.$8,1,_smim._TI.get_$K(),null,!0]],[[-1,4,null,null,null,"Text",null,_smim._TI.$H,0,null,null,null,_u.Strings.l_Smime_CertificateInformation_Text]],[[-1,0,["CertIssuedTo"],[_smim._TI.$CkA],null,"Text",null,_smim._TI.$H,1,null,null,null]],[[-1,0,["CertIssuedBy"],[_smim._TI.$Ck9],null,"Text",null,_smim._TI.$H,1,null,null,null]],[[-1,0,["CertValidPeriod"],[_smim._TI.$CkB],null,"Text",null,_smim._TI.$H,1,null,null,null]]]);var n=_smim._TI._hf.childNodes[5].cloneNode(!0);var e=new _fc.$A(_B.$3(n,[0,8,4]));var o=new _fc.$A(_B.$3(n,[0,8,2]));var s=new _fc.$A(_B.$3(n,[0,8,0]));var f=new _fc.$A(_B.$3(n,[0,6]));var r=new _js.$7(_B.$3(n,[0,4]));r.set_$6("SignatureDetailsView._tid2");var t=new _fc.$A(_B.$3(n,[0,2,0]));t.set_$18(41);t.set_$g(-1);var u=new _fc.$A(_B.$3(n,[0,0]));return new _B(n,[u,t,r,f,s,o,e])},_smim.$pk,_js.$7,!1,!1,!1,0,_smim._TI.$1)};_smim._TI.$9S=function(){var n=window.document.createElement("DIV");n.innerHTML="<div>  <span class='_smim_5 ms-font-weight-regular ms-font-color-themePrimary'></span> </div><div> <span autoid=\"_smim_0\" class='_smim_2'></span> <div autoid=\"_smim_1\" class='_smim_3'></div> <span autoid=\"_smim_2\" class='_smim_4 ms-font-weight-regular'></span> <a autoid=\"_smim_3\" class='_smim_5 ms-font-weight-regular ms-font-color-themePrimary'></a> <div autoid=\"_smim_4\" class='_smim_6'></div> </div><div> <span></span> </div><div> <div></div>  </div><div> <span class='_smim_8'></span> <hr/> <div class='_smim_9'> <div></div> </div> </div><div> <div class='_smim_7'> <span class='_smim_8'></span> <hr/> <div class='_smim_9'> <span></span> </div> <p></p> <div></div> <p></p> <span class='_smim_8'></span> <hr/> <div class='_smim_9'> <span></span> <p></p> <span></span> <p></p> <span></span> </div> </div> </div>";_js.$F.get_$9G().appendChild(n);return n};_smim._TI.$Ck6=function(n){return n.$NF};_smim._TI.$6et=function(n){return n.$3zM};_smim._TI.$Ck8=function(n){return n.$3V};_smim._TI.$6eu=function(n){return n.$7FR};_smim._TI.$Ck7=function(n){return n.$4I1};_smim._TI.$9p=function(n){return n.$3W};_smim._TI.$4w=function(n){return n.get_$1C()};_smim._TI.$Eh=function(n){return n.$5a};_smim._TI.$DS=function(n){return n.$9B};_smim._TI.$CyP=function(n){return n.$4v};_smim._TI.$CkE=function(n){return n.$3bL};_smim._TI.$CkC=function(n){return n.get_$E7y()};_smim._TI.$CkD=function(n){return n.get_$Efk()};_smim._TI.$CkA=function(n){return n.get_$AEH()};_smim._TI.$Ck9=function(n){return n.get_$AEG()};_smim._TI.$CkB=function(n){return n.get_$AEI()};_smim._TI.$H=function(n,t){n.set_$1K(t)};_smim._TI.$14=function(n,t){n.set_$2O(t)};_smim._TI.$8=function(n,t){n.set_$17(t)};_smim._TI.$5z=function(n,t){n.set_$NV(t)};_smim._TI.$a=function(n,t){n.set_$4k(t)};_smim._TI.$i=function(n,t){n.$6G=t};_smim._TI.$Z=function(n,t){n.set_$k(t)};_smim._TI.$Dj=function(n,t){n.set_$1C(t)};_smim._TI.$4g=function(n,t){n.set_$1C(t)};_smim._TI.$Dw=function(n,t){n.set_$ID(t)};_smim._TI.$BV=function(n,t){n.set_$H4(t)};_smim._TI.$DT=function(n,t){n.set_$IA(t)};_smim._TI.$2o=function(n,t){n.set_$20(t)};_smim._TI.get_$K=function(){_smim._TI.$2L||(_smim._TI.$2L=new _fc.$42);return _smim._TI.$2L};_smim.$1ZF.registerClass("_smim.$1ZF");_smim.$1Ql.registerClass("_smim.$1Ql",_smim.$1ZF,_y.$1Wf);_smim.$1a8.registerClass("_smim.$1a8",_smim.$1ZF,_y.$1WQ);_smim.$1Qf.registerClass("_smim.$1Qf",_smim.$1a8,_y.$1WR,_y.$1WQ);_smim.$1Qi.registerClass("_smim.$1Qi",null,IComponentOverrideFactory);_smim.$1Qj.registerClass("_smim.$1Qj",_smim.$1a8,_y.$1WW,_y.$1WQ);_smim.$1Qm.registerClass("_smim.$1Qm",_smim.$1a8,_y.$1WX,_y.$1WQ);_smim.$1Qp.registerClass("_smim.$1Qp",_smim.$1a8,_y.$1WV,_y.$1WQ);_smim.$1Qq.registerClass("_smim.$1Qq",_smim.$1a8,_y.$1WT,_y.$1WQ);_smim.$1Qk.registerClass("_smim.$1Qk",_smim.$1ZF,_y.$1We);_smim.$1Qg.registerClass("_smim.$1Qg",_smim.$1ZF,_y.$1WY);_smim.$hj.registerClass("_smim.$hj",_smim.$1ZF,_y.$1WS);_smim.$1Qn.registerClass("_smim.$1Qn",_smim.$1ZF,_y.$1Wd);_smim.$xM.registerClass("_smim.$xM",_a.$En);_smim.$pk.registerClass("_smim.$pk",_bc.$DH);_smim.$1Qh.registerClass("_smim.$1Qh",null,ISmimeCommandFactory);_smim.$hk.registerClass("_smim.$hk",_smim.$1ZF,_y.$1Vv);SmimeComponent.registerClass("SmimeComponent",null,_a.$1X7);_smim._TI.registerClass("_smim._TI");_smim._TI._hf=_smim._TI.$9S();_smim._TI.$2L=null;_smim._TI.$1={};_smim._TI.$$cctor();
window.scriptsLoaded['microsoft.exchange.clients.owa2.client.core.smime.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.exchange.clients.owa2.client.core.smime.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
